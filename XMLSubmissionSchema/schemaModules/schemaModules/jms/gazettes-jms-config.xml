<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:aop="http://www.springframework.org/schema/aop" 
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:jee="http://www.springframework.org/schema/jee" 
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:cache="http://www.springframework.org/schema/cache"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:jms="http://www.springframework.org/schema/jms"    
	xsi:schemaLocation="http://www.springframework.org/schema/aop 
			http://www.springframework.org/schema/aop/spring-aop-3.1.xsd   
			http://www.springframework.org/schema/beans 
			http://www.springframework.org/schema/beans/spring-beans-3.1.xsd   
			http://www.springframework.org/schema/context 
			http://www.springframework.org/schema/context/spring-context-3.1.xsd   
			http://www.springframework.org/schema/jee 
			http://www.springframework.org/schema/jee/spring-jee-3.1.xsd   
			http://www.springframework.org/schema/tx 
			http://www.springframework.org/schema/tx/spring-tx-3.1.xsd
			http://www.springframework.org/schema/cache 
			http://www.springframework.org/schema/cache/spring-cache-3.1.xsd
			http://www.springframework.org/schema/jms
			http://www.springframework.org/schema/jms/spring-jms-3.1.xsd">
			
	
	<bean id="gazettesJmsConnectionFactory" class="org.apache.activemq.pool.PooledConnectionFactory" destroy-method="stop">
		<property name="connectionFactory" ref="amqConnectionFactory"/>
	</bean>
	
	<bean id="cachingConnectionFactory" class="org.springframework.jms.connection.CachingConnectionFactory" destroy-method="destroy">
	    <property name="targetConnectionFactory" ref ="amqConnectionFactory" />
	</bean>

	<bean id="amqConnectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
		<property name="brokerURL" value="${jms.url}" />
	</bean> 
	
	<bean id = "gazettesJmsTemplate" class="org.springframework.jms.core.JmsTemplate">
		<property name="connectionFactory" ref="cachingConnectionFactory"/>
	</bean>
	
	<bean id="gazetteQueue" class="org.apache.activemq.command.ActiveMQQueue">
		<constructor-arg value="${gazettes.queue.name}"/>
	</bean>
	
	<bean id="gazetteClsQueue" class="org.apache.activemq.command.ActiveMQQueue">
		<constructor-arg value="${gazettes.cls.queue.name}"/>
	</bean>
	
	<bean id="postWordProcessingQueue" class="org.apache.activemq.command.ActiveMQQueue">
		<constructor-arg value="${post.word.automation.queue}"/>
	</bean>
	
	<bean id="gazettesJMSListener" class="uk.co.gazettes.services.jms.GazettesMessageListener">
		<property name="onwardChannel" ref="noticeEnrichRouterChannel" /> <!-- ref to channel inside workflow xmls -->
	</bean>
	
	<bean id="gazettesJMSClsListener" class="uk.co.gazettes.services.jms.GazettesMessageListener">
		<property name="onwardChannel" ref="noticeEnrichRouterChannel" /> <!-- ref to channel inside workflow xmls -->
	</bean>
	
	<bean id="postWordAutomationListener" class="uk.co.gazettes.services.jms.PostAutomationQueueListener">
		<property name="persistBundleChannel" ref="persistBundleChannel" />
	</bean>
	
	<bean id="gazettesPostPersistContainer"	class="org.springframework.jms.listener.DefaultMessageListenerContainer" >
		<property name="connectionFactory" ref="cachingConnectionFactory" />
		<property name="destination" ref="gazetteQueue" />
		<property name="sessionTransacted" value="true" />
		<property name="autoStartup" value="${jms.gazette.auto.start}" />
		<property name="concurrentConsumers" value="${broker.concurrent.consumers}"/>
		<property name="maxConcurrentConsumers" value="${broker.max.concurrent.consumer}"/>
		<property name="messageListener" ref="gazettesJMSListener"/> 
	</bean>
	
	<bean id="gazettesPostPersistClsContainer"	class="org.springframework.jms.listener.DefaultMessageListenerContainer" >
		<property name="connectionFactory" ref="cachingConnectionFactory" />
		<property name="destination" ref="gazetteClsQueue" />
		<property name="sessionTransacted" value="true" />
		<property name="autoStartup" value="${jms.cls.auto.start}" />
		<property name="concurrentConsumers" value="${broker.cls.concurrent.consumers}"/>
		<property name="maxConcurrentConsumers" value="${broker.cls.max.concurrent.consumer}"/>
		<property name="messageListener" ref="gazettesJMSClsListener"/> 
	</bean>
	
	<bean id="postWordAutomationListenerContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer" >
		<property name="connectionFactory" ref="cachingConnectionFactory" />
		<property name="destination" ref="postWordProcessingQueue" />
		<property name="sessionTransacted" value="true" />
		<!-- <property name="autoStartup" value="false" /> -->
		<property name="concurrentConsumers" value="${broker.concurrent.consumers}"/>
		<property name="maxConcurrentConsumers" value="${broker.max.concurrent.consumer}"/>
		<property name="messageListener" ref="postWordAutomationListener"/> 
	</bean>
	
	<bean name="gazettesJmsMessageQueueSender" class="uk.co.gazettes.services.jms.GazettesJmsMessageQueueSender"/>
			
</beans>